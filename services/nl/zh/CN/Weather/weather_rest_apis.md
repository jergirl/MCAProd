---

copyright:
  years: 2015, 2016

---

{:new_window: target="_blank"}
{:shortdesc: .shortdesc}
{:screen:.screen}
{:codeblock:.codeblock}

# 使用 Insights for Weather REST API
{: #rest_apis}

*上次更新时间：2016 年 4 月 6 日*

您可以使用 [Insights for Weather REST API](https://twcservice.{APPDomain}/rest-api/){:new_window} 来检索天气数据。可以测试 API 操作并立即查看结果，以帮助您更快地构建应用程序。

从参考文档中，单击**列出操作**可查看每个操作的详细信息。指定参数并单击**试试看！**时，系统可能会要求您提供凭证。必须提供 `VCAP_SERVICES` 环境变量中的用户名和密码。通过打开应用程序并单击目录中的**环境变量**，可以找到这些信息。

**注：**每个区域都是独立的。不能将在一个区域中为您供应的服务凭证用于向另一个区域中的服务进行认证。未输入正确的凭证将导致响应主体中显示“未授权”消息。

使用 Insights for Weather API，可以通过提供经度和纬度坐标表示地理位置来检索天气数据。可以使用以下 API。

|**API**                                  |**描述**              |
|-----------------------------------------|-----------------------------|
|`GET /v2/forecast/daily/10day`           |返回某个地理位置当天和未来 9 天的天气预测。每天天气预测可以包含白天天气预测和晚上天气预测。这些分段在 JSON 响应中是不同的对象。每天天气预测中的白天天气预测数据在当地时间下午 3:00 后不再可用。在当地时间下午 3:00 时，您的应用程序不能再显示白天天气预测。|
|`GET /v2/forecast/hourly/24hour`         |返回某个地理位置当天和未来 24 小时的每小时天气预测。每小时天气预测数据最多可以包含每个位置 24 小时的天气预测。对于某个位置，在收到新数据后，必须废弃先前所有每小时天气预测。|
|`GET /v2/observations/current`           |返回某个地理位置的最新天气状况。这些最近的观察数据会保留在数据库中，特定报告站的观察数据最多保留 10 分钟，每个观察站的观察数据最多保留 24 小时。最近的观察数据会基于观察数据的日期/时间戳记，通过先进/先出方法持续更新并进行替换（使用最新的观察数据来循环数据，并将最早的观察数据移至归档存储器）。|
|`GET /v2/observations/timeseries/24hour` |返回某个地理位置的最新观察数据以及从当前日期和时间开始一直到过去 24 小时的观察数据。天气观察数据是从部署在世界各地的物理设备以及最新天气观察 数据中收集而来的。|
*表 1. Insights for Weather API 摘要*

## 时间序列观察数据
{: #time_series}

时间序列观察数据提供有关温度、降水、风力、气压、能见度、紫外线 (UV) 辐射以及其他相关观察元素的信息，包括观察站、观察日期/时间、天气图标代码和用语。时间序列观察数据与最新观察数据的差异在于观察数据时间段，这将生成一个或多个观察数据集。

最新天气状况是在不使用时间参数时请求的位置的最新观察数据。这将返回一个数据集。时间序列观察数据包含过去的观察数据，一直到（且包括）过去 24 小时所请求位置的观察数据。

最近的观察数据会保留在主数据库中，最多保留特定报告站的 48 小时（2 天）的观察数据。最近的观察数据会基于观察数据的日期/时间戳记，通过先进/先出方法持续更新并进行替换（使用最新的观察数据来循环数据，并将最早的观察数据移至归档存储器）。保留且可从任何观察站可用的数据量可能会超过 24 小时单个观察报告的数据量。
观察次数由观察类型确定。

## URL 构造
{: #url_construction}

Insights for Weather API 使用常用 URL 结构和查询参数来请求和过滤天气数据。传递给 Insights for Weather API 的 URL 如下所示进行构造：

```
https://twcservice.mybluemix.net/api/weather/v2/<product group>/&format={format type}&geocode={latitude,longitude}&language={language code}&units={units code}

```

|**属性**     |**描述**                                    |
|------------------|---------------------------------------------------|
|`主机名`        |托管的 URL 路径（例如，`https://twcservice.mybluemix.net:443/api/weather`）|
|`版本`         |最新迭代（例如，“v2”）|
|`商品组`   |产品（例如，“观察数据”或“天气预测”）|
|`地理位置代码`         |可选的经度和纬度，例如“45.4214,75.6919”表示加拿大渥太华。如果提供了地理位置代码坐标，那么 API 会返回最近可用位置的数据。 句点用作十进制分隔符，逗号用于分隔经度和纬度值。如果提供了地理位置代码，那么会在响应的元数据中返回使用的实际经度和纬度值。|
|`语言`        |要返回的响应所用的语言。缺省值为 en-US。响应的元数据中的“语言”参数中将返回缺省或请求的转换语言。|
|`单位`           |要返回的响应所用的单位（可选）。API 支持英制 (e)、公制 (m) 和英制混合 (h) 度量单位。如果提供了度量单位但未提供值，API 将以与语言代码对应的度量单位返回数据。响应的元数据中的“单位”参数中将返回缺省或请求的度量单位。|
*表 2. URL 详细信息*

## 度量单位
{: #units_measure}

使用 Insights for Weather API 时，无需显式传递度量单位。Insights for Weather API 缺省为与 URL 中的语言代码关联的度量单位。但是，如果要提供不同于缺省值的度量单位，那么可以传递度量单位以覆盖缺省值。

* 对于 en-US 或 en，缺省度量单位为“英制”。单位代码为“e”。
* 对于 en-GB，缺省度量单位为“混合英制”。单位代码为“h”。
* 对于其他语言，缺省度量单位为“公制”。单位代码为“m”。

## 语言转换
{: #language_translation}

Insights for Weather API 将转换用语和度量单位。设置请求 URL 的格式时，必须提供有效的语言。将转换以下字段：

|**字段**           |**描述**                                    |
|--------------------|---------------------------------------------------|
|`narrative`         |24 小时时间段的描述性天气预测|
|`dow`               |一周中的某天|
|`wind_phrase`       |用于描述 12 小时日段的风向和风速的用语|
|`wdir_cardinal`     |以基本表示法表示的白天平均风向|
|`daypart_name`      |12 小时日段的名称，不包括前 48 小时中的日期名称|
|`temp_phrase`       |包含 12 小时预测时间段的预测温度上限或下限的简短用语|
|`shortcast`         |描述性天气预测中缩写的感测天气部分|
|`long_daypart_name` |扩展格式的有效天气预测的指定时间范围。指定的时间范围可以为 12 小时制或 24 小时制。|
|`golf_category`     |高尔夫指数类别，用描述打高尔夫球的天气状况用语表示|
|`phrase_nnchar`     |白天感测天气用语|
|`lunar_phrase`      |三个字符构成的农历用语简短代码|
|`uv_desc`           |UV 指数描述，通过提供因曝晒使皮肤受损的关联危险级别，对 UV 指数值进行补充|
|`sky_cover`         | 基于云层覆盖百分比描述的天空覆盖|
|`ptend_desc`        | 过去 3 小时气压趋势的描述性文本|
*表 3. 转换的响应字段*

## 处理 API 响应中的数据字段为空或缺少数据字段的问题
{: #handling_null_or_missing}

如果由于数据不可用而导致数据字段为空，那么 Insights for Weather API 会返回包含“空”的相应字段标签，或者根本就不返回字段。

## 处理错误
{: #handling_errors}

以下错误状态码通用于所有 API：

|**错误** |**描述**                                    |
|----------|---------------------------------------------------|
|400       |错误的请求。由于语法格式不正确，因此服务器无法识别请求。此错误代码适用于所有 API。如果提供了任何无效参数，那么 API 会拒绝该请求。|
|401       |未授权。请求需要认证。|
|403       |已禁止。服务器识别到请求，但拒绝执行该请求。|
|404       |找不到。如果必需参数在 API 请求中不存在，那么将返回 MissingParameterException 错误和 404 错误代码。|
|405       |方法不被允许。例如，发送 POST，而不是 GET。|
|406       |不可接受。例如，不接受 gzip 压缩响应。|
|408       |请求超时。客户机未在服务器预期的等待时间内生成请求。|
|500       |内部服务器错误。服务器遇到意外情况，导致无法执行请求。|
|502-504   |服务不可用或发生网关问题。如果服务暂时不可用，将会返回这些错误代码。|
*表 4. 错误响应代码*

有关错误的响应始终是相同的。在一个响应中可能会返回多个错误代码。
例如，返回的 JSON 错误响应可能如下所示：

```
{
  metadata: {
    transaction_id: "1411496413365:-1880721071"
  },
  success: false,
  errors: [
    {
      error: {
        code: "NDF-0001",
        message: "There was no data found for your product query."
      }
    }
}
```
