---

copyright:
  years: 2015, 2016

---

{:new_window: target="_blank"}
{:shortdesc: .shortdesc}
{:screen:.screen}
{:codeblock:.codeblock}

# Insights for Weather REST API の使用
{: #rest_apis}

*最終更新日: 2016 年 4 月 6 日*

[Insights for Weather REST API](https://twcservice.{APPDomain}/rest-api/){:new_window} を使用して、気象データを取得できます。API 操作をテストして即座に結果を表示できるため、アプリケーションを迅速にビルドするのに役立ちます。

リファレンス資料から、**「操作のリスト (List Operations)」**をクリックして、各操作の詳細を確認します。パラメーターを指定して**「試してみる (Try it out!)」**をクリックすると、資格情報の入力を求められる場合があります。`VCAP_SERVICES` 環境変数にあるユーザー名とパスワードを入力する必要があります。この情報は、アプリケーションを開いて
   目次から**「環境変数」**をクリック
   すると見つけられます。


**注:** 地域はそれぞれ独立しています。ある地域でユーザーにプロビジョンされたサービス資格情報を、別の地域でサービスに対する認証のために使用することはできません。正しい資格情報が入力されないと、応答本文に「無許可 (Unauthorized)」というメッセージが表示されます。

Insights for Weather API を使用すると、地理的位置を経度と緯度で指定して気象データを取得できます。
以下の API を使用できます。

|**API**                                  |**説明**              |
|-----------------------------------------|-----------------------------|
|`GET /v2/forecast/daily/10day`           |ある地理的位置について、今日と次の 9 日間の天気予報を返します。毎日の予報にはそれぞれ、昼間の予報と夜間の予報を含めることができます。これらの区分は、JSON 応答内の別個のオブジェクトです。毎日の予報の昼間予報データは、現地時間の午後 3 時以降は使用できなくなります。現地時間の午後 3 時に、日中の予報がアプリケーションに表示されないようにしなければなりません。|
|`GET /v2/forecast/hourly/24hour`         |ある地理的位置について、今日と次の 24 時間の毎時の予報を返します。毎時の予報データには、各地について 24 件までの毎時の予報を含めることができます。ある位置の以前の毎時の予報はすべて、新規データを受け取ったら破棄する必要があります。|
|`GET /v2/observations/current`           |ある地理的位置について、現在の気象条件を返します。これらの最近の観測は、特定のレポート局について 10 分間まで、局ごとに 24 時間の観測がデータベースに保持されます。最近の観測データは継続的に更新され、観測の日時スタンプに基づいて先入れ先出し法 (最新の観測のデータを循環し、最も古い観測をアーカイブ・ストレージに移動) で置き換えられます。|
|`GET /v2/observations/timeseries/24hour` |ある地理的位置について、現在の観測と、現在の日時から 24 時間前までの観測の両方を返します。世界各地に配備された物理デバイスおよび現在の気象観測から気象観測を収集します。|
*表 1. Insights for Weather API のサマリー*

## 時系列観測
{: #time_series}

時系列気象観測データは、気温、降水量、風、気圧、視程、紫外線 (UV) 放射、およびその他の関連する観測要素 (観測所、観測の日時、天気アイコンのコードと表現を含む) についての情報を提供します。時系列観測と現在の観測との違いは観測期間であり、これにより、1 つまたは複数の観測データ・セットが得られます。

現在の条件は、時間パラメーターなしで要求された位置の最新の観測です。1 つのデータ・セットが返されます。時系列観測には、要求された位置についての直近の 24 時間までに発生した過去の観測が含まれます。

最近の観測は、特定のレポート局について 48 時間 (2 日間) まで 1 次データベースに保持されます。最近の観測データは継続的に更新され、観測の日時スタンプに基づいて先入れ先出し法 (最新の観測のデータを循環し、最も古い観測をアーカイブ・ストレージに移動) で置き換えられます。各観測所で保持され、入手可能なデータの量は、24 の個別の観測レポートよりも多い可能性があります。観測の数は、観測のタイプによって決まります。

## URL の構造
{: #url_construction}

Insights for Weather API では、一般的な URL 構造およびクエリー・パラメーターを使用して、気象データの要求とフィルター操作を行います。
Insights for Weather API に渡される URL は、次のような構造です。

```
https://twcservice.mybluemix.net/api/weather/v2/<product group>/&format={format type}&geocode={latitude,longitude}&language={language code}&units={units code}

```

|**属性**     |**説明**                                    |
|------------------|---------------------------------------------------|
|`hostname`        |ホストされている URL のパス (例: `https://twcservice.mybluemix.net:443/api/weather`)|
|`version`         |現在の反復 (例: 「v2」)|
|`product group`   |商品 (例: 「observations」または「forecast」)|
|`geocode`         |オプションの緯度と経度。例えば、「45.4214,75.6919」はカナダのオタワを表します。ジオコードの座標を指定すると、利用可能な最も近い位置のデータが API から返されます。 小数点としてピリオドが使用され、緯度と経度の値を分離するためにコンマが使用されます。ジオコードを指定した場合、使用された実際の緯度と経度の値が、応答のメタデータで返されます。|
|`language`        |応答を返す言語。デフォルトは en-US です。デフォルトの言語または要求された翻訳言語が、応答のメタデータの language パラメーターで返されます。|
|`units`           |オプションの、応答を返す単位。API では、English (e)、Metric (m)、および UK-Hybrid (h) の計測単位がサポートされます。値を指定せずに計測単位を指定した場合は、言語コードに対応する計測単位でデータが返されます。デフォルトまたは要求された計測単位が、応答のメタデータの units パラメーターで返されます。|
*表 2. URL 詳細*

## 計測単位
{: #units_measure}

Insights for Weather API を使用するときに、計測単位を明示的に渡す必要はありません。Insights for Weather API は、URL の言語コードに関連付けられている計測単位にデフォルトで設定されます。ただし、デフォルトとは別の計測単位を指定したい場合は、計測単位を渡してデフォルトを指定変更することができます。

* en-US または en の場合、デフォルトの計測単位コードは English/Imperial です。単位コードは「e」です。
* en-GB の場合、デフォルトの計測単位は Hybrid-UK です。単位コードは「h」です。
* それ以外の場合、デフォルトの計測単位は Metric です。単位コードは「m」です。

## 言語の翻訳
{: #language_translation}

Insights for Weather API は、語句と計測単位を翻訳します。要求 URL のフォーマットを設定するときに、有効な言語を指定する必要があります。以下のフィールドが翻訳されます。

|**フィールド**           |**説明**                                    |
|--------------------|---------------------------------------------------|
|`narrative`         |24 時間の予報説明文。|
|`dow`               |曜日|
|`wind_phrase`       |12 時間の日中部分の風向と風速を記述する語句。|
|`wdir_cardinal`     |基本方位表記による、日中の平均の風向|
|`daypart_name`      |最初の 48 時間以内の、曜日を含まない 12 時間の日中部分の名前|
|`temp_phrase`       |12 時間の予報期間の最高気温または最低気温を含む短い語句|
|`shortcast`         |短縮された、予報説明文の知覚可能な気象部分|
|`long_daypart_name` |拡張フォーマットでの有効な天気予報の名前付き時間フレーム。名前付き時間フレームは、12 時間の場合と 24 時間の場合があります。|
|`golf_category`     |ゴルフをするための気象条件の語句として表現されたゴルフ指数カテゴリー|
|`phrase_nnchar`     |日中の知覚可能な天気を表現する語句|
|`lunar_phrase`      |月相の 3 文字の短いコード|
|`uv_desc`           |UV 指数の説明。皮膚暴露による肌へのダメージに関連するリスク・レベルを示すことにより、UV 指数の値を補足します。|
|`sky_cover`         | 雲量の割合に基づく、雲の量の説明|
|`ptend_desc`        | 過去 3 時間における気圧傾向の説明テキスト|
*表 3. 翻訳された応答フィールド*

## API 応答でのヌルのデータ・フィールドまたは欠落したデータ・フィールドの処理
{: #handling_null_or_missing}

データを入手できないためにデータ・フィールドがヌルである場合、Insights for Weather API は該当するフィールドのタグを「null」という語とともに返すか、フィールドを一切返しません。

## エラーの処理
{: #handling_errors}

以下のエラー・コードは、すべての API に共通です。

|**エラー** |**説明**                                    |
|----------|---------------------------------------------------|
|400       |要求が誤っています。構文の形式が正しくないため、サーバーは要求を理解しませんでした。このエラー・コードはすべての API に実装されています。無効なパラメーターが指定された場合、API は要求を拒否します。|
|401       |認証されていません。要求で認証が必要です。|
|403       |禁止されています。サーバーは、要求を理解しましたが、それを満たすことを拒否しています。|
|404       |見つかりません。必須パラメーターが API 要求に存在しない場合、MissingParameterException エラーが 404 エラー・コードとともに返されます。|
|405       |許可されていないメソッド。例えば、GET の代わりに POST を送信しています。|
|406       |受け入れられません。例えば、gzip で圧縮された応答は受け入れられません。|
|408       |要求のタイムアウト。サーバーの待機準備ができている時間内にクライアントが要求を生成しませんでした。|
|500       |内部サーバー・エラー。サーバーで予期しない状態が発生したため、要求を実行できませんでした。|
|502-504   |サービスが利用不可であるか、ゲートウェイの問題。これらのエラー・コードは、サービスが一時的に利用不可になっている場合に返されます。|
*表 4. エラー応答コード*

エラー時の応答は常に同じです。1 つの応答で複数のエラー・コードが返される場合があります。
例えば、JSON のエラー応答が以下のように返される場合があります。

```
{
  metadata: {
    transaction_id: "1411496413365:-1880721071"
  },
  success: false,
  errors: [
    {
      error: {
        code: "NDF-0001",
        message: "There was no data found for your product query."
      }
    }
}
```
